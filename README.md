# SessionFlow

SessionFlow 是一個任務管理系統，具有工作階段追蹤功能，專為提高個人或團隊工作效率而設計。

## 專案概述

SessionFlow 讓使用者能夠：

-   管理任務與子任務
-   為任務排程工作階段
-   追蹤工作時間與進度
-   查看工作統計資料

## 核心概念

-   **任務 (Task)**: 定義需要完成的工作項目
-   **工作階段 (Session)**: 任務在某天的具體排程，有起迄時間並支援計時，具有狀態管理功能（建立/進行中/暫停/完成）
-   **階段紀錄 (SessionLog)**: 記錄單次工作階段的啟動/暫停/結束時間

## 技術棧

-   **後端框架**: Spring Boot 3.4.6
-   **持久層**: Spring Data JPA, Hibernate
-   **資料庫**: H2 檔案式資料庫
-   **構建工具**: Maven
-   **Java 版本**: Java 17

## 快速開始

### 環境需求

-   JDK 17 或以上
-   Maven 3.6 或以上

### 建置與執行

1. 複製專案

```
git clone [repository-url]
cd sessionflow-backend
```

2. 使用 Maven 建置專案

```
mvn clean package
```

3. 執行應用程式

```
java -jar target/sessionflow-0.0.1-SNAPSHOT.jar
```

4. 應用程式將在 http://localhost:8080 啟動，H2 資料庫控制台可在 http://localhost:8080/h2-console 訪問

-   JDBC URL: jdbc:h2:file:./sessionflow_db
-   用戶名: sa
-   密碼: password

## API 文件

### 任務 (Tasks)

以下是任務管理相關的 API 端點：

#### 建立任務

-   **端點**: `POST /api/tasks`
-   **描述**: 建立新的任務
-   **請求格式**: JSON
-   **請求參數**:

| 參數名稱          | 類型         | 是否必填 | 描述                                             |
| ----------------- | ------------ | -------- | ------------------------------------------------ |
| title             | String       | 是       | 任務標題                                         |
| description       | String       | 否       | 任務描述                                         |
| estimatedDuration | Integer      | 否       | 預估時間（分鐘）                                 |
| dueTime           | ISO 日期時間 | 否       | 到期時間                                         |
| status            | String       | 否       | 任務狀態（`ACTIVE`/`ARCHIVED`），預設為 `ACTIVE` |
| tags              | Array        | 否       | 任務標籤列表                                     |

-   **請求範例**:

```json
{
    "title": "任務標題",
    "description": "任務描述",
    "estimatedDuration": 60,
    "dueTime": "2023-11-09T12:00:00",
    "status": "ACTIVE",
    "tags": []
}
```

-   **回應格式**: JSON
-   **回應狀態碼**: 201 Created
-   **回應範例**:

```json
{
    "id": 1,
    "title": "任務標題",
    "description": "任務描述",
    "estimatedDuration": 60,
    "dueTime": "2023-11-09T12:00:00",
    "status": "ACTIVE",
    "tags": [],
    "createdAt": "2023-11-01T10:00:00",
    "updatedAt": "2023-11-01T10:00:00"
}
```

#### 獲取所有任務

-   **端點**: `GET /api/tasks`
-   **描述**: 獲取所有任務或按狀態過濾的任務
-   **請求格式**: URL query 參數
-   **請求參數**:

| 參數名稱 | 類型   | 是否必填 | 描述                                                      |
| -------- | ------ | -------- | --------------------------------------------------------- |
| status   | String | 否       | 任務狀態過濾（`ACTIVE`/`ARCHIVED`），不提供則返回所有任務 |

-   **回應格式**: JSON Array
-   **回應狀態碼**: 200 OK
-   **回應範例**:

```json
[
    {
        "id": 1,
        "title": "任務標題",
        "description": "任務描述",
        "estimatedDuration": 60,
        "dueTime": "2023-11-09T12:00:00",
        "status": "ACTIVE",
        "tags": [],
        "createdAt": "2023-11-01T10:00:00",
        "updatedAt": "2023-11-01T10:00:00"
    }
]
```

#### 獲取單一任務

-   **端點**: `GET /api/tasks/{id}`
-   **描述**: 獲取指定 ID 的任務
-   **請求參數**:

| 參數名稱 | 類型 | 是否必填 | 描述              |
| -------- | ---- | -------- | ----------------- |
| id       | Long | 是       | 任務 ID，路徑參數 |

-   **回應格式**: JSON
-   **回應狀態碼**: 200 OK / 404 Not Found
-   **回應範例**:

```json
{
    "id": 1,
    "title": "任務標題",
    "description": "任務描述",
    "estimatedDuration": 60,
    "dueTime": "2023-11-09T12:00:00",
    "status": "ACTIVE",
    "tags": [],
    "createdAt": "2023-11-01T10:00:00",
    "updatedAt": "2023-11-01T10:00:00"
}
```

#### 更新任務

-   **端點**: `PUT /api/tasks/{id}`
-   **描述**: 更新指定 ID 的任務
-   **請求格式**: JSON
-   **請求參數**:

| 參數名稱          | 類型         | 是否必填 | 描述                            |
| ----------------- | ------------ | -------- | ------------------------------- |
| id                | Long         | 是       | 任務 ID，路徑參數               |
| title             | String       | 是       | 任務標題                        |
| description       | String       | 否       | 任務描述                        |
| estimatedDuration | Integer      | 否       | 預估時間（分鐘）                |
| dueTime           | ISO 日期時間 | 否       | 到期時間                        |
| status            | String       | 否       | 任務狀態（`ACTIVE`/`ARCHIVED`） |
| tags              | Array        | 否       | 任務標籤列表                    |

-   **回應格式**: JSON
-   **回應狀態碼**: 200 OK / 404 Not Found / 400 Bad Request
-   **回應內容**: 更新後的任務資料

#### 刪除任務

-   **端點**: `DELETE /api/tasks/{id}`
-   **描述**: 刪除指定 ID 的任務
-   **請求參數**:

| 參數名稱 | 類型 | 是否必填 | 描述              |
| -------- | ---- | -------- | ----------------- |
| id       | Long | 是       | 任務 ID，路徑參數 |

-   **回應狀態碼**: 204 No Content / 404 Not Found
-   **說明**: 刪除任務的同時會連帶刪除關聯的工作階段與階段紀錄

### 工作階段 (Sessions)

以下是工作階段管理相關的 API 端點：

#### 建立工作階段

-   **端點**: `POST /api/sessions`
-   **描述**: 建立新的工作階段
-   **請求格式**: JSON
-   **請求參數**:

| 參數名稱  | 類型     | 是否必填 | 描述                             |
| --------- | -------- | -------- | -------------------------------- |
| taskId    | Long     | 是       | 關聯的任務 ID                    |
| date      | ISO 日期 | 是       | 工作階段日期（格式：YYYY-MM-DD） |
| startTime | 時間     | 是       | 開始時間（格式：HH:mm:ss）       |
| endTime   | 時間     | 是       | 結束時間（格式：HH:mm:ss）       |

-   **請求範例**:

```json
{
    "taskId": 1,
    "date": "2023-11-09",
    "startTime": "09:00:00",
    "endTime": "12:00:00"
}
```

-   **回應格式**: JSON
-   **回應狀態碼**: 201 Created
-   **回應範例**:

```json
{
    "id": 1,
    "taskId": 1,
    "date": "2023-11-09",
    "startTime": "09:00:00",
    "endTime": "12:00:00",
    "status": "CREATED",
    "logs": [],
    "createdAt": "2023-11-01T10:00:00",
    "updatedAt": "2023-11-01T10:00:00"
}
```

#### 獲取當日工作階段

-   **端點**: `GET /api/sessions`
-   **描述**: 獲取指定日期的所有工作階段
-   **請求格式**: URL query 參數
-   **請求參數**:

| 參數名稱 | 類型     | 是否必填 | 描述                             |
| -------- | -------- | -------- | -------------------------------- |
| date     | ISO 日期 | 是       | 工作階段日期（格式：YYYY-MM-DD） |

-   **回應格式**: JSON Array
-   **回應狀態碼**: 200 OK
-   **回應範例**:

```json
[
    {
        "id": 1,
        "taskId": 1,
        "date": "2023-11-09",
        "startTime": "09:00:00",
        "endTime": "12:00:00",
        "status": "CREATED",
        "logs": [],
        "createdAt": "2023-11-01T10:00:00",
        "updatedAt": "2023-11-01T10:00:00"
    }
]
```

#### 獲取單一工作階段

-   **端點**: `GET /api/sessions/{id}`
-   **描述**: 獲取指定 ID 的工作階段詳細資料
-   **請求參數**:

| 參數名稱 | 類型 | 是否必填 | 描述                  |
| -------- | ---- | -------- | --------------------- |
| id       | Long | 是       | 工作階段 ID，路徑參數 |

-   **回應格式**: JSON
-   **回應狀態碼**: 200 OK / 404 Not Found
-   **回應範例**: 包含工作階段詳細資料與關聯的階段紀錄

#### 更新工作階段

-   **端點**: `PUT /api/sessions/{id}`
-   **描述**: 更新指定 ID 的工作階段
-   **請求格式**: JSON
-   **請求參數**:

| 參數名稱  | 類型     | 是否必填 | 描述                             |
| --------- | -------- | -------- | -------------------------------- |
| id        | Long     | 是       | 工作階段 ID，路徑參數            |
| taskId    | Long     | 是       | 關聯的任務 ID                    |
| date      | ISO 日期 | 是       | 工作階段日期（格式：YYYY-MM-DD） |
| startTime | 時間     | 是       | 開始時間（格式：HH:mm:ss）       |
| endTime   | 時間     | 是       | 結束時間（格式：HH:mm:ss）       |

-   **回應格式**: JSON
-   **回應狀態碼**: 200 OK / 404 Not Found / 400 Bad Request
-   **回應內容**: 更新後的工作階段資料

#### 刪除工作階段

-   **端點**: `DELETE /api/sessions/{id}`
-   **描述**: 刪除指定 ID 的工作階段
-   **請求參數**:

| 參數名稱 | 類型 | 是否必填 | 描述                  |
| -------- | ---- | -------- | --------------------- |
| id       | Long | 是       | 工作階段 ID，路徑參數 |

-   **回應狀態碼**: 204 No Content / 404 Not Found
-   **說明**: 刪除工作階段的同時會連帶刪除關聯的階段紀錄

### 工作階段狀態 (Session Status)

工作階段具有以下狀態：

- `CREATED`: 工作階段初始創建狀態
- `IN_PROGRESS`: 工作階段進行中
- `PAUSED`: 工作階段暫停
- `COMPLETED`: 工作階段已完成

以下是工作階段狀態管理相關的 API 端點：

#### 啟動工作階段

-   **端點**: `POST /api/sessions/{id}/start`
-   **描述**: 將工作階段狀態更改為進行中，並自動創建新的計時紀錄
-   **請求參數**:

| 參數名稱 | 類型 | 是否必填 | 描述                  |
| -------- | ---- | -------- | --------------------- |
| id       | Long | 是       | 工作階段 ID，路徑參數 |

-   **回應格式**: JSON
-   **回應狀態碼**: 200 OK / 400 Bad Request / 404 Not Found
-   **回應範例**: 更新後的工作階段資料

#### 暫停工作階段

-   **端點**: `POST /api/sessions/{id}/pause`
-   **描述**: 將工作階段狀態更改為暫停，並自動記錄當前計時結束
-   **請求參數**:

| 參數名稱 | 類型 | 是否必填 | 描述                  |
| -------- | ---- | -------- | --------------------- |
| id       | Long | 是       | 工作階段 ID，路徑參數 |

-   **回應格式**: JSON
-   **回應狀態碼**: 200 OK / 400 Bad Request / 404 Not Found
-   **回應範例**: 更新後的工作階段資料

#### 完成工作階段

-   **端點**: `POST /api/sessions/{id}/complete`
-   **描述**: 將工作階段狀態更改為已完成，並自動記錄當前計時結束
-   **請求參數**:

| 參數名稱 | 類型 | 是否必填 | 描述                  |
| -------- | ---- | -------- | --------------------- |
| id       | Long | 是       | 工作階段 ID，路徑參數 |

-   **回應格式**: JSON
-   **回應狀態碼**: 200 OK / 400 Bad Request / 404 Not Found
-   **回應範例**: 更新後的工作階段資料

#### 重置工作階段

-   **端點**: `POST /api/sessions/{id}/reset`
-   **描述**: 將工作階段狀態重置為初始狀態
-   **請求參數**:

| 參數名稱 | 類型 | 是否必填 | 描述                  |
| -------- | ---- | -------- | --------------------- |
| id       | Long | 是       | 工作階段 ID，路徑參數 |

-   **回應格式**: JSON
-   **回應狀態碼**: 200 OK / 400 Bad Request / 404 Not Found
-   **回應範例**: 更新後的工作階段資料

### 階段紀錄 (SessionLogs)

以下是工作階段紀錄相關的 API 端點：

#### 啟動計時

-   **端點**: `POST /api/sessions/{sessionId}/logs`
-   **描述**: 為特定工作階段建立新的計時紀錄
-   **請求參數**:

| 參數名稱  | 類型 | 是否必填 | 描述                  |
| --------- | ---- | -------- | --------------------- |
| sessionId | Long | 是       | 工作階段 ID，路徑參數 |

-   **回應格式**: JSON
-   **回應狀態碼**: 201 Created
-   **回應範例**:

```json
{
    "id": 1,
    "sessionId": 1,
    "startTime": "2023-11-09T09:00:00",
    "endTime": null,
    "duration": null,
    "note": null
}
```

#### 獲取階段紀錄

-   **端點**: `GET /api/sessions/{sessionId}/logs`
-   **描述**: 獲取特定工作階段的所有計時紀錄
-   **請求參數**:

| 參數名稱  | 類型 | 是否必填 | 描述                  |
| --------- | ---- | -------- | --------------------- |
| sessionId | Long | 是       | 工作階段 ID，路徑參數 |

-   **回應格式**: JSON Array
-   **回應狀態碼**: 200 OK / 404 Not Found
-   **回應內容**: 工作階段紀錄列表

#### 更新階段紀錄

-   **端點**: `PATCH /api/logs/{id}`
-   **描述**: 更新階段紀錄（可用於暫停/繼續/結束計時）
-   **請求格式**: JSON
-   **請求參數**:

| 參數名稱 | 類型         | 是否必填 | 描述                  |
| -------- | ------------ | -------- | --------------------- |
| id       | Long         | 是       | 階段紀錄 ID，路徑參數 |
| endTime  | ISO 日期時間 | 否       | 結束時間              |
| duration | Long         | 否       | 持續時間（秒）        |
| note     | String       | 否       | 工作紀錄備註          |

-   **請求範例**:

```json
{
    "endTime": "2023-11-09T10:30:00",
    "duration": 5400,
    "note": "完成了部分工作"
}
```

-   **回應格式**: JSON
-   **回應狀態碼**: 200 OK / 404 Not Found / 400 Bad Request
-   **回應內容**: 更新後的階段紀錄資料

#### 刪除階段紀錄

-   **端點**: `DELETE /api/logs/{id}`
-   **描述**: 刪除指定 ID 的階段紀錄
-   **請求參數**:

| 參數名稱 | 類型 | 是否必填 | 描述                  |
| -------- | ---- | -------- | --------------------- |
| id       | Long | 是       | 階段紀錄 ID，路徑參數 |

-   **回應狀態碼**: 204 No Content / 404 Not Found

## 錯誤處理

所有 API 錯誤都會以統一格式返回:

```json
{
    "timestamp": "2023-11-09T12:00:00",
    "status": 400,
    "message": "具體錯誤訊息"
}
```

對於資料驗證錯誤，會返回更詳細的欄位錯誤資訊:

```json
{
    "timestamp": "2023-11-09T12:00:00",
    "status": 400,
    "message": "Validation failed",
    "errors": {
        "title": "標題不能為空",
        "estimatedDuration": "預估時間必須為正數"
    }
}
```
