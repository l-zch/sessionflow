import{a as X,d as fe,r as $,c as E,T as ee,u as re,b as B,e as S,w as P,n as L,f as r,g as y,_ as O,h as f,I as z,i as se,o as C,j as K,k as R,t as N,l as V,m as pe,F as U,p as q,q as ve,s as be,v as x,x as de,y as A,z as F,A as ae,B as ye,C as he,D as W,E as J,G as j,H as ue,J as Te,K as we}from"./index.js";const Y={async getTags(){return X.get("/tags")},async createTag(o){return X.post("/tags",o)},async updateTag(o,t){return X.put(`/tags/${o}`,t)},async deleteTag(o){await X.delete(`/tags/${o}`)}},Z=fe("tags",()=>{const o=$([]),t=$(!1),e=$(!1),s=$(""),l=E(()=>{const c=new Map;return o.value.forEach(d=>c.set(d.id,d)),c}),u=E(()=>c=>l.value.get(c)),a=["#fecaca","#fed7aa","#fef3c7","#d9f99d","#a7f3d0","#a5f3fc","#bfdbfe","#c4b5fd","#f0abfc","#e5e7eb"],m=E(()=>o.value.map(c=>c.color)),n=E(()=>a.filter(c=>!m.value.includes(c)));return{tags:o,isLoading:t,isCreating:e,error:s,tagMap:l,getTagById:u,availableColors:a,usedColors:m,unusedColors:n,fetchTags:async()=>{try{t.value=!0,s.value="";const c=await Y.getTags();o.value=c.map(d=>new ee(d))}catch(c){s.value=c instanceof Error?c.message:"載入標籤失敗",console.error("Failed to fetch tags:",c)}finally{t.value=!1}},createTag:async c=>{try{e.value=!0,s.value="";const d=await Y.createTag(c),T=new ee(d);return o.value.push(T),T}catch(d){throw s.value=d instanceof Error?d.message:"建立標籤失敗",console.error("Failed to create tag:",d),d}finally{e.value=!1}},updateTag:async(c,d)=>{try{t.value=!0,s.value="";const T=await Y.updateTag(c,d),_=new ee(T),M=o.value.findIndex(D=>D.id===c);return M!==-1&&(o.value[M]=_),_}catch(T){throw s.value=T instanceof Error?T.message:"更新標籤失敗",console.error("Failed to update tag:",T),T}finally{t.value=!1}},deleteTag:async c=>{try{t.value=!0,s.value="",await Y.deleteTag(c),o.value=o.value.filter(d=>d.id!==c)}catch(d){throw s.value=d instanceof Error?d.message:"刪除標籤失敗",console.error("Failed to delete tag:",d),d}finally{t.value=!1}},clearError:()=>{s.value=""},initSync:()=>{console.log("Tag WebSocket sync initialized")},teardownSync:()=>{console.log("Tag WebSocket sync torn down")},handleTagNotification:c=>{console.log("Tag notification received:",c)}}});function ke(){const o=re(),t=$(!1);return{isSubmitting:t,handleCreateTask:async(m,n)=>{try{t.value=!0,await o.createTask(m),n==null||n()}catch(p){console.error("Failed to create task:",p)}finally{t.value=!1}},handleUpdateTask:async(m,n,p)=>{try{t.value=!0,await o.updateTask(m,n),p==null||p()}catch(v){console.error("Failed to update task:",v)}finally{t.value=!1}},handleDeleteTask:async(m,n)=>{try{t.value=!0,await o.deleteTask(m),n==null||n()}catch(p){console.error("Failed to delete task:",p)}finally{t.value=!1}},handleTaskComplete:async m=>{try{await o.completeTask(m)}catch(n){console.error("Failed to complete task:",n)}},handleTaskReopen:async m=>{try{await o.reopenTask(m)}catch(n){console.error("Failed to reopen task:",n)}}}}function Ce(){const o=$(!1),t=$(!1),e=$(!1),s=$();return{showCreateModal:o,showEditModal:t,showDeleteModal:e,selectedTask:s,openCreateModal:()=>{o.value=!0},closeCreateModal:()=>{o.value=!1},openEditModal:v=>{s.value=v,t.value=!0},closeEditModal:()=>{t.value=!1,s.value=void 0},openDeleteModal:v=>{s.value=v,e.value=!0},closeDeleteModal:()=>{e.value=!1,t.value=!1,s.value=void 0}}}const xe=["data-completed"],$e=["checked","disabled"],_e={class:"icon-container absolute inset-0 flex items-center justify-center transition-transform duration-300"},Ee=B({__name:"TaskCompleteButton",props:{isCompleted:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},size:{default:"sm"}},emits:["click"],setup(o,{emit:t}){const e=o,s=t,l=$(!1),u=E(()=>{const n={sm:"w-6 h-6",md:"w-7 h-7",lg:"w-8 h-8"},p="border-primary bg-transparent text-primary hover:bg-primary/10",v=e.loading?"opacity-50 cursor-not-allowed":"",b=l.value?"animating":"";return[n[e.size],p,v,b].filter(Boolean).join(" ")}),a=E(()=>({sm:"sm",md:"md",lg:"lg"})[e.size]),m=async n=>{if(e.loading)return;n.stopPropagation(),l.value=!0;const p=new MouseEvent("click",{bubbles:!1,cancelable:!0});s("click",p),await se(),setTimeout(()=>{l.value=!1},400)};return(n,p)=>(C(),S("label",{class:L([u.value,"task-complete-button inline-flex items-center justify-center font-medium rounded-full cursor-pointer border-2 relative overflow-hidden transition-all duration-300 focus-within:outline-none"]),"data-completed":n.isCompleted,onClick:p[0]||(p[0]=P(()=>{},["stop"]))},[r("input",{type:"checkbox",checked:n.isCompleted,disabled:n.loading,onChange:m,class:"sr-only"},null,40,$e),p[1]||(p[1]=r("div",{class:"expand-bg absolute inset-0 rounded-full bg-primary opacity-0"},null,-1)),r("div",_e,[y(O,{icon:n.isCompleted?f(z).TASK_REOPEN:f(z).TASK_COMPLETE,size:a.value},null,8,["icon","size"])])],10,xe))}}),Se=(o,t)=>{const e=o.__vccOpts||o;for(const[s,l]of t)e[s]=l;return e},De=Se(Ee,[["__scopeId","data-v-326261ef"]]),Me={class:"truncate"},ce=B({__name:"BaseTag",props:{name:{},color:{default:"#e5e7eb"},removable:{type:Boolean,default:!1},size:{default:"md"}},emits:["remove"],setup(o){const t=o,e=a=>{if(!a)return"#374151";const m=parseInt(a.slice(1,3),16),n=parseInt(a.slice(3,5),16),p=parseInt(a.slice(5,7),16);return(m*299+n*587+p*114)/1e3>=128?"#374151":"#ffffff"},s=E(()=>({backgroundColor:t.color,color:e(t.color)})),l=E(()=>["inline-flex items-center rounded-full font-medium cursor-pointer",{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm",lg:"px-3 py-1.5 text-base"}[t.size]].join(" ")),u=E(()=>({sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"})[t.size]);return(a,m)=>(C(),S("span",{class:L(l.value),style:K(s.value)},[r("span",Me,N(a.name),1),a.removable?(C(),S("button",{key:0,type:"button",class:L(["ml-0.5 inline-flex items-center justify-center rounded-full hover:bg-black/10 focus:outline-none focus:bg-black/10",u.value]),onClick:m[0]||(m[0]=P(n=>a.$emit("remove"),["stop"]))},[y(O,{icon:f(z).CLOSE,style:K({color:s.value.color}),size:"xs"},null,8,["icon","style"])],2)):R("",!0)],6))}}),Fe=o=>{const t=typeof o=="string"?new Date(o):o,e=new Date,s=t.getTime()-e.getTime(),l=Math.ceil(s/(1e3*60*60*24));return l<0?`逾期 ${Math.abs(l)} 天`:l===0?"今天到期":l===1?"明天到期":`${l} 天後到期`},Ie={class:"min-w-0"},Ae={class:"text-md text-neutral-800 truncate"},ze={class:"flex gap-1 flex-wrap min-w-0"},Be={class:"min-w-0"},Ne={key:1,class:"text-sm text-neutral-400"},Oe=B({__name:"TaskItem",props:{task:{},isActive:{type:Boolean,default:!1},isCompleteLoading:{type:Boolean,default:!1},showActions:{type:Boolean,default:!0}},emits:["complete","reopen","edit"],setup(o,{emit:t}){const e=o,s=t,{openCreateModal:l}=ve(),u=E(()=>e.showActions?"grid-cols-[24px_32px_2fr_1fr_minmax(120px,max-content)]":"grid-cols-[24px_2fr_1fr_minmax(120px,max-content)]"),a=E(()=>e.isActive?"border-primary bg-primary/10":"border-gray-200 hover:border-gray-300 hover:bg-primary/10 active:border-primary"),m=()=>{l(e.task)},n=E(()=>e.task.dueTime?Fe(e.task.dueTime):""),p=E(()=>{if(!e.task.dueTime)return"text-neutral-500";const k=e.task.dueTime,h=new Date,w=k.getTime()-h.getTime(),i=Math.ceil(w/(1e3*60*60*24));return i<0?"text-red-600":i<=1?"text-red-400 font-medium":"text-neutral-600"}),v=()=>{e.task.isComplete?s("reopen",e.task.id):s("complete",e.task.id)},b=k=>{k.target.closest("button")||s("edit",e.task)};return(k,h)=>(C(),S("div",{class:L([[a.value,u.value],"grid items-center gap-4 p-3 rounded-lg transition-colors cursor-pointer"]),onClick:b},[y(De,{"is-completed":k.task.isComplete,loading:k.isCompleteLoading,size:"md",onClick:P(v,["stop"])},null,8,["is-completed","loading"]),k.showActions?(C(),V(pe,{key:0,icon:f(z).SESSION_START,variant:"secondary",size:"md",onClick:P(m,["stop"])},null,8,["icon"])):R("",!0),r("div",Ie,[r("h3",Ae,N(k.task.title),1)]),r("div",ze,[(C(!0),S(U,null,q(k.task.tags,w=>(C(),V(ce,{key:w.id,name:w.name,color:w.color,size:"sm"},null,8,["name","color"]))),128))]),r("div",Be,[k.task.dueTime?(C(),S("span",{key:0,class:L([p.value,"text-sm"])},N(n.value),3)):(C(),S("span",Ne," 無截止時間 "))])],2))}}),Ve={class:"flex flex-col relative no-scrollbar"},Le={key:0},Re={class:"min-w-0"},je={key:0,class:"text-center text-gray-500 absolute top-20 left-1/2 -translate-x-1/2"},Pe={class:"text-lg font-medium mb-2"},Ue={class:"text-sm"},We={class:"absolute bottom-0 left-0 h-16 flex flex-col gap-2 w-full z-10 bg-linear-to-t from-stone-50 to-stone-50/0 from-60%"},Ge=B({__name:"TaskList",props:{tasks:{default:()=>[]},activeTaskId:{},activeSessionTaskId:{},sessionLoadingTaskId:{},completeLoadingTaskId:{}},emits:["startSession","endSession","complete","reopen","edit"],setup(o,{emit:t}){const e=o,s=t,l=$(!1),u=$(!1),a=$(new Map),m=E(()=>l.value?"grid-cols-[24px_2fr_1fr_minmax(120px,max-content)]":"grid-cols-[24px_32px_2fr_1fr_minmax(120px,max-content)]"),n=E(()=>{let d=e.tasks.filter(T=>{if(a.value.has(T.id)){const _=a.value.get(T.id);if(_==="completing")return!l.value;if(_==="reopening")return l.value}return l.value?T.isComplete:!T.isComplete});return u.value&&!l.value?[...d].sort((T,_)=>!T.dueTime&&!_.dueTime?0:T.dueTime?_.dueTime?T.dueTime.getTime()-_.dueTime.getTime():-1:1):d}),p=E(()=>l.value?"顯示待完成任務":"已完成的任務"),v=()=>{l.value=!l.value,l.value&&(u.value=!1)},b=()=>{l.value||(u.value=!u.value)},k=d=>{s("startSession",d)},h=d=>{s("endSession",d)},w=async d=>{a.value.set(d,"completing"),s("complete",d),await se(),setTimeout(()=>{a.value.delete(d)},200)},i=async d=>{a.value.set(d,"reopening"),s("reopen",d),await se(),setTimeout(()=>{a.value.delete(d)},200)},g=d=>{s("edit",d)},c=d=>{if(a.value.has(d.id)){const T=a.value.get(d.id),_=Object.create(Object.getPrototypeOf(d));return Object.assign(_,d),T==="completing"?_.status="PENDING":T==="reopening"&&(_.status="COMPLETE"),_}return d};return(d,T)=>(C(),S("div",Ve,[r("div",{class:L(["grid items-center gap-4 px-3 pb-2 text-sm text-neutral-500 border-b border-gray-200",m.value])},[T[1]||(T[1]=r("div",null,null,-1)),l.value?R("",!0):(C(),S("div",Le)),T[2]||(T[2]=r("div",{class:"min-w-0"},[r("span",null,"任務")],-1)),T[3]||(T[3]=r("div",{class:"min-w-0"},[r("span",null,"標籤")],-1)),r("div",Re,[r("button",{class:"hover:text-primary transition-colors flex items-center gap-1",onClick:b},[T[0]||(T[0]=r("span",null,"截止時間",-1)),y(O,{icon:f(z).CHEVRON_UP,size:"sm",class:L(u.value?"text-primary":"")},null,8,["icon","class"])])])],2),y(be,{tag:"div",name:"task-list",class:"relative overflow-y-auto pt-2 no-scrollbar flex-1"},{default:x(()=>[(C(!0),S(U,null,q(n.value,_=>(C(),V(Oe,{key:_.id,task:c(_),"is-active":d.activeTaskId===_.id,"is-session-loading":d.sessionLoadingTaskId===_.id,"is-complete-loading":d.completeLoadingTaskId===_.id,"has-active-session":d.activeSessionTaskId===_.id,"show-actions":!l.value,onStartSession:k,onEndSession:h,onComplete:w,onReopen:i,onEdit:g},null,8,["task","is-active","is-session-loading","is-complete-loading","has-active-session","show-actions"]))),128)),T[4]||(T[4]=r("div",{key:"bottom-spacer",class:"h-16"},null,-1))]),_:1,__:[4]}),y(de,{name:"empty-state-fade"},{default:x(()=>[n.value.length===0?(C(),S("div",je,[r("div",Pe,N(l.value?"沒有已完成的任務":"沒有待完成的任務"),1),r("div",Ue,N(l.value?"完成一些任務後就會顯示在這裡":"建立新任務開始使用吧！"),1)])):R("",!0)]),_:1}),r("div",We,[y(A,{variant:"dimmed",class:"w-fit mt-auto",size:"sm",onClick:v},{default:x(()=>[F(N(p.value),1)]),_:1})])]))}});function qe(o){return ye()?(he(o),!0):!1}const me=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const He=Object.prototype.toString,Ke=o=>He.call(o)==="[object Object]",G=()=>{},Je=Qe();function Qe(){var o,t;return me&&((o=window==null?void 0:window.navigator)==null?void 0:o.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((t=window==null?void 0:window.navigator)==null?void 0:t.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function te(o){return Array.isArray(o)?o:[o]}function Xe(o,t,e){return ae(o,t,{...e,immediate:!0})}const ge=me?window:void 0;function H(o){var t;const e=W(o);return(t=e==null?void 0:e.$el)!=null?t:e}function oe(...o){const t=[],e=()=>{t.forEach(m=>m()),t.length=0},s=(m,n,p,v)=>(m.addEventListener(n,p,v),()=>m.removeEventListener(n,p,v)),l=E(()=>{const m=te(W(o[0])).filter(n=>n!=null);return m.every(n=>typeof n!="string")?m:void 0}),u=Xe(()=>{var m,n;return[(n=(m=l.value)==null?void 0:m.map(p=>H(p)))!=null?n:[ge].filter(p=>p!=null),te(W(l.value?o[1]:o[0])),te(f(l.value?o[2]:o[1])),W(l.value?o[3]:o[2])]},([m,n,p,v])=>{if(e(),!(m!=null&&m.length)||!(n!=null&&n.length)||!(p!=null&&p.length))return;const b=Ke(v)?{...v}:v;t.push(...m.flatMap(k=>n.flatMap(h=>p.map(w=>s(k,h,w,b)))))},{flush:"post"}),a=()=>{u(),e()};return qe(e),a}let ne=!1;function Ye(o,t,e={}){const{window:s=ge,ignore:l=[],capture:u=!0,detectIframe:a=!1,controls:m=!1}=e;if(!s)return m?{stop:G,cancel:G,trigger:G}:G;if(Je&&!ne){ne=!0;const g={passive:!0};Array.from(s.document.body.children).forEach(c=>c.addEventListener("click",G,g)),s.document.documentElement.addEventListener("click",G,g)}let n=!0;const p=g=>W(l).some(c=>{if(typeof c=="string")return Array.from(s.document.querySelectorAll(c)).some(d=>d===g.target||g.composedPath().includes(d));{const d=H(c);return d&&(g.target===d||g.composedPath().includes(d))}});function v(g){const c=W(g);return c&&c.$.subTree.shapeFlag===16}function b(g,c){const d=W(g),T=d.$.subTree&&d.$.subTree.children;return T==null||!Array.isArray(T)?!1:T.some(_=>_.el===c.target||c.composedPath().includes(_.el))}const k=g=>{const c=H(o);if(g.target!=null&&!(!(c instanceof Element)&&v(o)&&b(o,g))&&!(!c||c===g.target||g.composedPath().includes(c))){if("detail"in g&&g.detail===0&&(n=!p(g)),!n){n=!0;return}t(g)}};let h=!1;const w=[oe(s,"click",g=>{h||(h=!0,setTimeout(()=>{h=!1},0),k(g))},{passive:!0,capture:u}),oe(s,"pointerdown",g=>{const c=H(o);n=!p(g)&&!!(c&&!g.composedPath().includes(c))},{passive:!0}),a&&oe(s,"blur",g=>{setTimeout(()=>{var c;const d=H(o);((c=s.document.activeElement)==null?void 0:c.tagName)==="IFRAME"&&!(d!=null&&d.contains(s.document.activeElement))&&t(g)},0)},{passive:!0})].filter(Boolean),i=()=>w.forEach(g=>g());return m?{stop:i,cancel:()=>{n=!1},trigger:g=>{n=!0,k(g),n=!1}}:i}const Ze={key:0,class:"text-neutral-400"},et={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-stone-300 rounded-lg shadow-lg no-scrollbar"},tt={class:"max-h-60 overflow-y-auto py-1 no-scrollbar"},ot={key:0,class:"px-3 py-2 text-neutral-500 text-sm"},st=["onClick"],at={class:"flex items-center gap-2"},lt=["onClick"],nt=B({__name:"TagInput",props:{selectedTags:{},availableTags:{}},emits:["add-tag","remove-tag","create-new","edit-tag"],setup(o,{emit:t}){const e=t,s=$(null),l=$(!1),u=()=>{l.value=!l.value},a=()=>{l.value=!1},m=b=>{e("add-tag",b)},n=b=>{e("remove-tag",b)},p=b=>{e("edit-tag",b),a()},v=()=>{e("create-new"),a()};return Ye(s,a),(b,k)=>(C(),S("div",{class:"relative",ref_key:"rootEl",ref:s},[r("div",{onClick:u,class:L(["w-full min-h-[42px] p-2 rounded-lg border transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white border-stone-300 text-neutral-700 placeholder-neutral-400 flex flex-wrap gap-2 items-center",{"ring-2 ring-primary border-transparent":l.value}]),tabindex:"0"},[(C(!0),S(U,null,q(b.selectedTags,h=>(C(),V(ce,{key:h.id,name:h.name,color:h.color,removable:"",onRemove:w=>n(h),class:"hover:opacity-80 transition-opacity"},null,8,["name","color","onRemove"]))),128)),b.selectedTags.length===0?(C(),S("span",Ze," 選擇標籤... ")):R("",!0)],2),y(de,{"enter-active-class":"transition-opacity duration-100","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:x(()=>[l.value?(C(),S("div",et,[r("ul",tt,[b.availableTags.length===0?(C(),S("li",ot," 沒有可用的標籤 ")):R("",!0),(C(!0),S(U,null,q(b.availableTags,h=>(C(),S("li",{key:h.id,class:"px-3 py-2 hover:bg-primary/10 flex items-center justify-between text-sm relative",onClick:w=>m(h)},[r("div",at,[r("span",{class:"w-3 h-3 rounded-full",style:K({backgroundColor:h.color})},null,4),r("span",null,N(h.name),1)]),r("div",{class:"h-8 w-8 flex items-center justify-center absolute right-2 top-[1/2] text-stone-400 hover:text-primary",onClick:P(w=>p(h),["stop"])},[y(O,{icon:f(z).EDIT,class:"w-4 h-4"},null,8,["icon"])],8,lt)],8,st))),128)),r("li",{class:"border-t border-stone-200 px-3 py-2 mt-1 hover:bg-primary/10 cursor-pointer text-sm text-primary",onClick:v}," + 建立新標籤 ")])])):R("",!0)]),_:1})],512))}}),it={class:"grid grid-cols-5 gap-3"},rt=["onClick"],dt={class:"flex items-center justify-end gap-3"},ut=B({__name:"TagCreateModal",props:{show:{type:Boolean},isSubmitting:{type:Boolean,default:!1},existingTagNames:{default:()=>[]}},emits:["close","create"],setup(o,{emit:t}){const e=o,s=t,l=$(""),u=$(""),a=$({name:"",color:""}),m=[{name:"red",hex:"FFE2E2",bg:"bg-red-100",border:"border-red-300"},{name:"orange",hex:"FFEDD4",bg:"bg-orange-100",border:"border-orange-300"},{name:"yellow",hex:"FEF9C2",bg:"bg-yellow-100",border:"border-yellow-300"},{name:"lime",hex:"ECFCCA",bg:"bg-lime-100",border:"border-lime-300"},{name:"emerald",hex:"D0FAE5",bg:"bg-emerald-100",border:"border-emerald-300"},{name:"cyan",hex:"CEFAFE",bg:"bg-cyan-100",border:"border-cyan-300"},{name:"blue",hex:"DBEAFE",bg:"bg-blue-100",border:"border-blue-300"},{name:"violet",hex:"DDD6FE",bg:"bg-violet-100",border:"border-violet-300"},{name:"fuchsia",hex:"FAE8FF",bg:"bg-fuchsia-100",border:"border-fuchsia-300"},{name:"gray",hex:"F3F4F6",bg:"bg-gray-100",border:"border-gray-300"}],n=h=>/^([0-9A-F]{6})$/i.test(h),p=()=>{var h;return a.value={name:"",color:""},l.value.trim()?(h=e.existingTagNames)!=null&&h.includes(l.value.trim().toLowerCase())&&(a.value.name="此標籤名稱已存在"):a.value.name="標籤名稱為必填項目",u.value&&!n(u.value)&&(a.value.color="請輸入有效的十六進位色碼"),!a.value.name&&!a.value.color},v=E(()=>l.value.trim()!==""&&(u.value===""||n(u.value))),b=h=>{u.value=h},k=()=>{if(!p())return;const h={name:l.value.trim()};u.value&&(h.color=`#${u.value}`),s("create",h)};return(h,w)=>(C(),V(J,{title:"建立新標籤",show:h.show,onClose:w[3]||(w[3]=i=>h.$emit("close"))},{footer:x(()=>[r("div",dt,[y(A,{type:"button",variant:"secondary",onClick:w[2]||(w[2]=i=>h.$emit("close"))},{default:x(()=>w[5]||(w[5]=[F(" 取消 ")])),_:1,__:[5]}),y(A,{type:"submit",loading:h.isSubmitting,disabled:!v.value,onClick:k},{default:x(()=>w[6]||(w[6]=[F(" 建立 ")])),_:1,__:[6]},8,["loading","disabled"])])]),default:x(()=>[r("form",{onSubmit:P(k,["prevent"]),class:"space-y-6"},[y(j,{id:"tagName",label:"標籤名稱",modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=i=>l.value=i),placeholder:"輸入標籤名稱...",required:"",error:a.value.name},null,8,["modelValue","error"]),y(j,{id:"tagColor",label:"顏色 (選填)",modelValue:u.value,"onUpdate:modelValue":w[1]||(w[1]=i=>u.value=i),placeholder:"#",class:"w-[6em]",error:a.value.color},{prepend:x(()=>w[4]||(w[4]=[r("span",{class:"inline-flex items-center px-3 border border-r-0 border-neutral-300 bg-neutral-50 text-neutral-500 sm:text-sm rounded-l-md"}," # ",-1)])),append:x(()=>[r("div",{class:"w-6 h-6 rounded-md border border-neutral-300",style:K({backgroundColor:n(u.value)?`#${u.value}`:"transparent"})},null,4)]),_:1},8,["modelValue","error"]),r("div",null,[r("div",it,[(C(),S(U,null,q(m,i=>r("button",{key:i.name,type:"button",class:L(["w-full h-8 rounded-md transition-transform duration-100 ease-in-out hover:scale-110 focus:outline-none",[i.bg,u.value===i.hex?["border-2",i.border]:""]]),onClick:g=>b(i.hex)},null,10,rt)),64))])])],32)]),_:1},8,["show"]))}}),ct={class:"grid grid-cols-5 gap-3"},mt=["onClick"],gt={class:"flex items-center justify-between w-full"},ft={class:"flex items-center gap-3"},pt=B({__name:"TagEditModal",props:{show:{type:Boolean},tag:{},existingTagNames:{},isSubmitting:{type:Boolean,default:!1}},emits:["close","update","delete"],setup(o,{emit:t}){const e=o,s=t,l=$(""),u=$(""),a=$({name:"",color:""}),m=E(()=>{var i;return`編輯標籤：${((i=e.tag)==null?void 0:i.name)||""}`}),n=[{name:"red",hex:"fecaca",bg:"bg-red-200",border:"border-red-400"},{name:"orange",hex:"fed7aa",bg:"bg-orange-200",border:"border-orange-400"},{name:"yellow",hex:"fef3c7",bg:"bg-yellow-200",border:"border-yellow-400"},{name:"lime",hex:"d9f99d",bg:"bg-lime-200",border:"border-lime-400"},{name:"emerald",hex:"a7f3d0",bg:"bg-emerald-200",border:"border-emerald-400"},{name:"cyan",hex:"a5f3fc",bg:"bg-cyan-200",border:"border-cyan-400"},{name:"blue",hex:"bfdbfe",bg:"bg-blue-200",border:"border-blue-400"},{name:"violet",hex:"c4b5fd",bg:"bg-violet-200",border:"border-violet-400"},{name:"fuchsia",hex:"f0abfc",bg:"bg-fuchsia-200",border:"border-fuchsia-400"},{name:"gray",hex:"e5e7eb",bg:"bg-gray-200",border:"border-gray-400"}],p=i=>/^([0-9A-F]{6})$/i.test(i),v=E(()=>p(u.value)?`#${u.value}`:"transparent"),b=()=>{var i;return a.value={name:"",color:""},l.value.trim()?e.existingTagNames.includes(l.value.trim().toLowerCase())&&l.value.trim().toLowerCase()!==((i=e.tag)==null?void 0:i.name.toLowerCase())&&(a.value.name="此標籤名稱已存在"):a.value.name="標籤名稱為必填項目",u.value&&!p(u.value)&&(a.value.color="請輸入有效的 6 位十六進位色碼"),!a.value.name&&!a.value.color},k=E(()=>l.value.trim()!==""&&(u.value===""||p(u.value))),h=i=>{u.value=i},w=()=>{if(!b()||!e.tag)return;const i={id:e.tag.id,name:l.value.trim(),color:`#${u.value}`};s("update",i)};return ae(()=>e.tag,i=>{i&&(l.value=i.name,u.value=i.color.startsWith("#")?i.color.substring(1):i.color,a.value={name:"",color:""})},{immediate:!0}),(i,g)=>(C(),V(J,{show:i.show,title:m.value,onClose:g[4]||(g[4]=c=>i.$emit("close"))},{"header-icon":x(()=>[y(O,{icon:f(z).EDIT,class:"text-neutral-500"},null,8,["icon"])]),footer:x(()=>[r("div",gt,[y(A,{type:"button",variant:"danger",onClick:g[2]||(g[2]=c=>i.tag&&i.$emit("delete",i.tag))},{default:x(()=>[y(O,{icon:f(z).DELETE},null,8,["icon"]),g[6]||(g[6]=r("span",{class:"ml-2"},"刪除",-1))]),_:1,__:[6]}),r("div",ft,[y(A,{type:"button",variant:"secondary",onClick:g[3]||(g[3]=c=>i.$emit("close"))},{default:x(()=>g[7]||(g[7]=[F(" 取消 ")])),_:1,__:[7]}),y(A,{type:"submit",loading:i.isSubmitting,disabled:!k.value,onClick:w},{default:x(()=>g[8]||(g[8]=[F(" 儲存變更 ")])),_:1,__:[8]},8,["loading","disabled"])])])]),default:x(()=>[r("form",{onSubmit:P(w,["prevent"]),class:"space-y-6"},[y(j,{id:"tagName",label:"標籤名稱",modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=c=>l.value=c),placeholder:"輸入標籤名稱...",required:"",error:a.value.name},null,8,["modelValue","error"]),y(j,{id:"tagColor",label:"顏色",modelValue:u.value,"onUpdate:modelValue":g[1]||(g[1]=c=>u.value=c),placeholder:"例如 FFFfff",class:"w-[8em]",error:a.value.color},{prepend:x(()=>g[5]||(g[5]=[r("span",{class:"inline-flex items-center px-3 border border-r-0 border-neutral-300 bg-neutral-50 text-neutral-500 sm:text-sm rounded-l-md"}," # ",-1)])),append:x(()=>[r("div",{class:"w-6 h-6 rounded-md border border-neutral-300 ml-2",style:K({backgroundColor:v.value})},null,4)]),_:1},8,["modelValue","error"]),r("div",null,[r("div",ct,[(C(),S(U,null,q(n,c=>r("button",{key:c.name,type:"button",class:L(["w-full h-8 rounded-md transition-transform duration-100 ease-in-out hover:scale-110 focus:outline-none",[c.bg,u.value.toLowerCase()===c.hex.toLowerCase()?["border-2",c.border]:""]]),onClick:d=>h(c.hex)},null,10,mt)),64))])])],32)]),_:1},8,["show","title"]))}}),vt={class:"space-y-4"},bt={class:"flex items-start gap-3"},yt={class:"flex-shrink-0"},ht={class:"flex-1"},Tt={class:"text-sm text-neutral-600 mb-4"},wt=B({__name:"TagDeleteConfirm",props:{show:{type:Boolean},tag:{},isDeleting:{type:Boolean,default:!1}},emits:["close","confirm"],setup(o){return(t,e)=>(C(),V(J,{show:t.show,title:"刪除標籤",size:"sm",onClose:e[2]||(e[2]=s=>t.$emit("close"))},{footer:x(()=>[y(A,{variant:"secondary",onClick:e[0]||(e[0]=s=>t.$emit("close"))},{default:x(()=>e[6]||(e[6]=[F(" 取消 ")])),_:1,__:[6]}),y(A,{variant:"danger",loading:t.isDeleting,onClick:e[1]||(e[1]=s=>t.$emit("confirm"))},{default:x(()=>e[7]||(e[7]=[F(" 刪除標籤 ")])),_:1,__:[7]},8,["loading"])]),default:x(()=>{var s;return[r("div",vt,[r("div",bt,[r("div",yt,[y(O,{icon:f(z).WARNING,size:"lg",class:"text-red-500 flex-shrink-0 mt-0.5"},null,8,["icon"])]),r("div",ht,[e[5]||(e[5]=r("h3",{class:"text-lg font-medium text-neutral-900 mb-2"}," 確定要刪除這個標籤嗎？ ",-1)),r("p",Tt,[e[3]||(e[3]=F(" 標籤「")),r("strong",null,N((s=t.tag)==null?void 0:s.name),1),e[4]||(e[4]=F("」將被永久刪除，此操作無法復原。 "))])])])])]}),_:1},8,["show"]))}});function kt(o){const t=$({title:"",tagIds:[],dueTime:"",note:""}),e=$({}),s=E(()=>!!o),l=E(()=>t.value.title.trim().length>0&&Object.keys(e.value).length===0),u=()=>{e.value={},t.value.title.trim()?t.value.title.length>255&&(e.value.title="標題不能超過 255 字元"):e.value.title="請輸入任務標題",t.value.note&&t.value.note.length>2e3&&(e.value.note="備註不能超過 2000 字元"),t.value.dueTime&&new Date(t.value.dueTime)<new Date&&(e.value.dueTime="截止日期不能早於現在")},a=n=>{var p;if(u(),Object.keys(e.value).length===0){const v={title:t.value.title.trim(),tagIds:t.value.tagIds,dueTime:t.value.dueTime||void 0,note:(p=t.value.note)==null?void 0:p.trim()};n(v)}},m=()=>{o?t.value={title:o.title,tagIds:o.tags.map(n=>n.id),dueTime:o.dueTime?o.dueTime.toISOString().slice(0,16):"",note:o.note||""}:t.value={title:"",tagIds:[],dueTime:"",note:""},e.value={}};return ae(()=>o,m,{immediate:!0}),{formData:t,errors:e,isEdit:s,isFormValid:l,validateForm:u,handleSubmit:a,initializeForm:m}}function Ct(o){const t=Z(),e=E(()=>t.tags.filter(a=>o.value.tagIds.includes(a.id))),s=E(()=>t.tags.filter(a=>!o.value.tagIds.includes(a.id)));return{selectedTags:e,availableTags:s,addTag:a=>{a.id&&!o.value.tagIds.includes(a.id)&&o.value.tagIds.push(a.id)},removeTag:a=>{a.id!==void 0&&(o.value.tagIds=o.value.tagIds.filter(m=>m!==a.id))}}}function xt(){const o=Z(),t=$(null),e=$(null),s=$(!1),l=$(!1),u=$(!1),a=E(()=>o.tags.map(b=>b.name.toLowerCase())),m=b=>{t.value=b,s.value=!0},n=()=>{s.value=!1,t.value=null};return{selectedTagForEdit:t,selectedTagForDelete:e,isEditModalOpen:s,isDeleteModalOpen:l,isSubmitting:u,existingTagNames:a,openEditModal:m,closeEditModal:n,openDeleteModal:b=>{e.value=b,l.value=!0,s.value&&n()},closeDeleteModal:()=>{l.value=!1,e.value=null}}}const $t={key:0,class:"flex items-center justify-end gap-3 pt-4 border-t border-neutral-300"},_t=B({__name:"TaskForm",props:{task:{},isSubmitting:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1}},emits:["submit","cancel","delete"],setup(o,{expose:t,emit:e}){const s=o,l=e,u=Z(),{formData:a,errors:m,isEdit:n,isFormValid:p,handleSubmit:v}=kt(s.task),{selectedTags:b,availableTags:k,addTag:h,removeTag:w}=Ct(a),i=xt(),g=$(!1),c=async M=>{try{const D=await u.createTag({name:M.name,color:M.color||"#e5e7eb"});D&&(g.value=!1,h(D))}catch(D){console.error("Failed to create and select tag:",D)}},d=async M=>{i.isSubmitting.value=!0;try{await u.updateTag(M.id,{name:M.name,color:M.color}),i.closeEditModal()}finally{i.isSubmitting.value=!1}},T=async()=>{if(i.selectedTagForDelete.value){i.isSubmitting.value=!0;try{w(i.selectedTagForDelete.value),await u.deleteTag(i.selectedTagForDelete.value.id),i.closeDeleteModal()}finally{i.isSubmitting.value=!1}}},_=()=>{v(M=>{l("submit",M)})};return t({submitForm:_}),ue(()=>{u.tags.length===0&&u.fetchTags()}),(M,D)=>(C(),S(U,null,[r("form",{onSubmit:P(_,["prevent"]),class:"space-y-6"},[y(j,{id:"title",label:"任務標題",modelValue:f(a).title,"onUpdate:modelValue":D[0]||(D[0]=I=>f(a).title=I),placeholder:"輸入任務標題...",required:"",error:f(m).title},null,8,["modelValue","error"]),y(j,{id:"tags",label:"標籤"},{default:x(()=>[y(nt,{"selected-tags":f(b),"available-tags":f(k),onAddTag:f(h),onRemoveTag:f(w),onCreateNew:D[1]||(D[1]=I=>g.value=!0),onEditTag:f(i).openEditModal},null,8,["selected-tags","available-tags","onAddTag","onRemoveTag","onEditTag"])]),_:1}),y(j,{id:"dueTime",label:"截止日期",type:"datetime-local",modelValue:f(a).dueTime,"onUpdate:modelValue":D[2]||(D[2]=I=>f(a).dueTime=I),error:f(m).dueTime,help:"選擇任務的截止日期和時間"},null,8,["modelValue","error"]),y(j,{id:"note",label:"備註",modelValue:f(a).note,"onUpdate:modelValue":D[3]||(D[3]=I=>f(a).note=I),placeholder:"輸入任務備註...",multiline:"",rows:4,error:f(m).note,help:"最多 2000 字元"},null,8,["modelValue","error"]),Te(M.$slots,"footer",{},()=>[M.hideActions?R("",!0):(C(),S("div",$t,[y(A,{type:"button",variant:"secondary",onClick:D[4]||(D[4]=I=>M.$emit("cancel"))},{default:x(()=>D[6]||(D[6]=[F(" 取消 ")])),_:1,__:[6]}),y(A,{type:"submit",loading:M.isSubmitting,disabled:!f(p)},{default:x(()=>[F(N(f(n)?"更新任務":"建立任務"),1)]),_:1},8,["loading","disabled"])]))])],32),y(ut,{show:g.value,"is-submitting":f(u).isCreating,"existing-tag-names":f(i).existingTagNames.value,onClose:D[5]||(D[5]=I=>g.value=!1),onCreate:c},null,8,["show","is-submitting","existing-tag-names"]),y(pt,{show:f(i).isEditModalOpen.value,tag:f(i).selectedTagForEdit.value,"is-submitting":f(i).isSubmitting.value,"existing-tag-names":f(i).existingTagNames.value,onClose:f(i).closeEditModal,onUpdate:d,onDelete:f(i).openDeleteModal},null,8,["show","tag","is-submitting","existing-tag-names","onClose","onDelete"]),y(wt,{show:f(i).isDeleteModalOpen.value,tag:f(i).selectedTagForDelete.value,"is-deleting":f(i).isSubmitting.value,onClose:f(i).closeDeleteModal,onConfirm:T},null,8,["show","tag","is-deleting","onClose"])],64))}}),Et={class:"flex w-full items-center justify-between"},St={key:1},Dt={class:"flex items-center gap-3"},ie=B({__name:"TaskModal",props:{show:{type:Boolean},task:{},isSubmitting:{type:Boolean,default:!1}},emits:["close","submit","delete"],setup(o,{emit:t}){const e=o,s=t,l=$(),u=E(()=>!!e.task),a=E(()=>u.value?"編輯任務":"建立新任務"),m=E(()=>u.value?"更新任務":"建立任務"),n=v=>{s("submit",v)},p=()=>{var v;(v=l.value)==null||v.submitForm()};return(v,b)=>(C(),V(J,{show:v.show,title:a.value,size:"lg",onClose:b[3]||(b[3]=k=>v.$emit("close"))},{footer:x(()=>[r("div",Et,[u.value?(C(),V(A,{key:0,type:"button",variant:"danger",onClick:b[1]||(b[1]=k=>v.$emit("delete"))},{default:x(()=>[y(O,{icon:f(z).DELETE},null,8,["icon"]),b[4]||(b[4]=r("span",{class:"ml-2"},"刪除",-1))]),_:1,__:[4]})):(C(),S("div",St)),r("div",Dt,[y(A,{type:"button",variant:"secondary",onClick:b[2]||(b[2]=k=>v.$emit("close"))},{default:x(()=>b[5]||(b[5]=[F(" 取消 ")])),_:1,__:[5]}),y(A,{loading:v.isSubmitting,onClick:p},{default:x(()=>[F(N(m.value),1)]),_:1},8,["loading"])])])]),default:x(()=>[y(_t,{ref_key:"taskFormRef",ref:l,task:v.task,"is-submitting":v.isSubmitting,onSubmit:n,onCancel:b[0]||(b[0]=k=>v.$emit("close")),"hide-actions":""},null,8,["task","is-submitting"])]),_:1},8,["show","title"]))}}),Mt={class:"space-y-4"},Ft={class:"flex items-start gap-3"},It={class:"flex-shrink-0"},At={class:"flex-1"},zt={class:"text-sm text-neutral-600 mb-4"},Bt={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3"},Nt={class:"flex items-start gap-2"},Ot=B({__name:"TaskDeleteConfirm",props:{show:{type:Boolean},task:{},isDeleting:{type:Boolean,default:!1},hasRelatedData:{type:Boolean,default:!1}},emits:["close","confirm"],setup(o){return(t,e)=>(C(),V(J,{show:t.show,title:"刪除任務",size:"sm",onClose:e[2]||(e[2]=s=>t.$emit("close"))},{footer:x(()=>[y(A,{variant:"secondary",onClick:e[0]||(e[0]=s=>t.$emit("close"))},{default:x(()=>e[7]||(e[7]=[F(" 取消 ")])),_:1,__:[7]}),y(A,{variant:"danger",loading:t.isDeleting,onClick:e[1]||(e[1]=s=>t.$emit("confirm"))},{default:x(()=>e[8]||(e[8]=[F(" 刪除任務 ")])),_:1,__:[8]},8,["loading"])]),default:x(()=>{var s;return[r("div",Mt,[r("div",Ft,[r("div",It,[y(O,{icon:f(z).WARNING,size:"lg",class:"text-red-500 flex-shrink-0 mt-0.5"},null,8,["icon"])]),r("div",At,[e[6]||(e[6]=r("h3",{class:"text-lg font-medium text-neutral-900 mb-2"}," 確定要刪除這個任務嗎？ ",-1)),r("p",zt,[e[3]||(e[3]=F(" 任務「")),r("strong",null,N((s=t.task)==null?void 0:s.title),1),e[4]||(e[4]=F("」將被永久刪除，此操作無法復原。 "))]),t.hasRelatedData?(C(),S("div",Bt,[r("div",Nt,[y(O,{icon:f(z).WARNING,size:"lg",class:"text-yellow-600 flex-shrink-0 mt-0.5"},null,8,["icon"]),e[5]||(e[5]=r("div",{class:"text-sm text-yellow-800"},[r("p",{class:"font-medium"},"注意："),r("p",null,"刪除此任務也會同時刪除相關的工作階段、階段紀錄和排程項目。")],-1))])])):R("",!0)])])])]}),_:1},8,["show"]))}}),Vt={class:"bg-stone-50 border border-neutral-300 rounded-xl pb-0 flex flex-col h-full"},Rt=B({__name:"TasksPage",setup(o){const t=re(),e=Z(),{isSubmitting:s,handleTaskComplete:l,handleTaskReopen:u,handleCreateTask:a,handleUpdateTask:m,handleDeleteTask:n}=ke(),{showCreateModal:p,showEditModal:v,showDeleteModal:b,selectedTask:k,openCreateModal:h,closeCreateModal:w,openEditModal:i,closeEditModal:g,openDeleteModal:c,closeDeleteModal:d}=Ce(),T=I=>{a(I,w)},_=I=>{k.value&&m(k.value.id,I,g)},M=()=>{k.value&&n(k.value.id,d)},D=I=>{i(I)};return ue(async()=>{await Promise.all([t.fetchTasks(),e.fetchTags()])}),(I,Q)=>(C(),S(U,null,[r("div",Vt,[y(Ge,{class:"flex-1 overflow-y-auto m-4 mt-3",tasks:f(t).filteredTasks,onEdit:D,onComplete:f(l),onReopen:f(u)},null,8,["tasks","onComplete","onReopen"]),y(ie,{show:f(p),"is-submitting":f(s),onClose:f(w),onSubmit:T},null,8,["show","is-submitting","onClose"]),y(ie,{show:f(v),task:f(k),"is-submitting":f(s),onClose:f(g),onSubmit:_,onDelete:Q[0]||(Q[0]=le=>f(c)(f(k)))},null,8,["show","task","is-submitting","onClose"]),y(Ot,{show:f(b),task:f(k),"is-deleting":f(s),onClose:f(d),onConfirm:M},null,8,["show","task","is-deleting","onClose"])]),(C(),V(we,{to:"body"},[r("button",{onClick:Q[1]||(Q[1]=(...le)=>f(h)&&f(h)(...le)),class:"fixed bottom-0 right-0 w-20 h-20 bg-primary/100 text-white origin-bottom-right hover:scale-120 transition-all z-50 flex p-9 rounded-tl-full shadow-lg","aria-label":"建立任務"},[y(O,{icon:f(z).ADD,size:"2xl"},null,8,["icon"])])]))],64))}});export{Rt as default};
